#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Customize to your needs...
# .local in path
export PATH="$HOME/.local/bin:$PATH"

if [[ -d "$HOME/.deno" ]]; then
  export PATH="$HOME/.deno/bin:$PATH"
fi

# Flyctl
if [[ -d "$HOME/.fly" ]]; then
  export FLYCTL_INSTALL="$HOME/.fly"
  export PATH="$FLYCTL_INSTALL/bin:$PATH"
fi

# Gems â€” find whatever ruby version is installed
for _gemdir in "$HOME"/.local/share/gem/ruby/*/bin(NOn); do
  export PATH="$_gemdir:$PATH"
  break  # use newest version only
done
unset _gemdir

# Let's use nvim instead of vim for most things
if command -v nvim &> /dev/null; then
  alias vim='nvim'
fi

# directory hops
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# Zoxied and stuff
if command -v zoxide &> /dev/null; then
  eval "$(zoxide init zsh)"
fi

zd() {
  if [ $# -eq 0 ]; then
    builtin cd ~ && return
  elif [ -d "$1" ]; then
    builtin cd "$1"
  else
    z "$@" && printf "\U000F17A9 " && pwd || echo "Error: Directory not found"
  fi
}
alias cd='zd'

# Mise setup
if command -v mise &> /dev/null; then
  eval "$(mise activate zsh)"
fi


# tools
alias d='docker'
alias decompress='tar -xzf'   # expects a .tar.gz filename after it

# fuzzy find with preview
if command -v fzf &> /dev/null && command -v bat &> /dev/null; then
  alias ff="fzf --preview 'bat --style=numbers --color=always {}'"
fi

# git
alias g='git'
alias gcad='git commit -a --amend'
alias gcam='git commit -a -m'
alias gcm='git commit -m'

# listing (eza)
if command -v eza &> /dev/null; then
  alias ls='eza -lh --group-directories-first --icons=auto'
  alias lsa='ls -a'
  alias lt='eza --tree --level=2 --long --icons --git'
  alias lta='lt -a'
fi

# bun completions
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"

# Modern pager setup
if command -v bat &> /dev/null; then
  export PAGER='bat --plain'
  export MANPAGER="sh -c 'col -bx | bat -l man --plain'"
fi
export LESS='-g -i -M -R -S -w -z4'
